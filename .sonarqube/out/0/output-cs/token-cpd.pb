 &
GC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\CardDiscounts.cs
	namespace 	
VVPS_UPR
 
{ 
internal		 
enum		 !
DiscountCardsInternal		 '
{

 
FamilyCardAdult 
, 
FamilyCardChild 
, 

SeniorCard 
} 
public 

enum 
DiscountCards 
{ 

FamilyCard 
, 

SeniorCard 
} 
public 

class 
CardDiscounts 
{ 
private 

Dictionary 
< !
DiscountCardsInternal 0
,0 1
decimal2 9
>9 :

_discounts; E
{F G
getH K
;K L
setM P
;P Q
}R S
public 
CardDiscounts 
( 
List !
<! "

Dictionary" ,
<, -
string- 3
,3 4
object5 ;
>; <
>< =!
config_card_discounts> S
)S T
{ 	

_discounts 
= 
new 

Dictionary '
<' (!
DiscountCardsInternal( =
,= >
decimal? F
>F G
(G H
)H I
;I J
foreach 
( 
var 
discount_card &
in' )!
config_card_discounts* ?
)? @
{ 
var   
	card_name   
=   
(    !
string  ! '
)  ' (
discount_card  ( 5
[  5 6
$str  6 <
]  < =
;  = >
var!! 
discount!! 
=!! 
decimal!! &
.!!& '
Parse!!' ,
(!!, -
discount_card!!- :
[!!: ;
$str!!; E
]!!E F
.!!F G
ToString!!G O
(!!O P
)!!P Q
)!!Q R
;!!R S
switch## 
(## 
	card_name## !
)##! "
{$$ 
case%% 
$str%% ,
:%%, -

_discounts&& "
.&&" #
Add&&# &
(&&& '!
DiscountCardsInternal&&' <
.&&< =
FamilyCardAdult&&= L
,&&L M
discount&&N V
)&&V W
;&&W X
break'' 
;'' 
case(( 
$str(( ,
:((, -

_discounts)) "
.))" #
Add))# &
())& '!
DiscountCardsInternal))' <
.))< =
FamilyCardChild))= L
,))L M
discount))N V
)))V W
;))W X
break** 
;** 
case++ 
$str++ &
:++& '

_discounts,, "
.,," #
Add,,# &
(,,& '!
DiscountCardsInternal,,' <
.,,< =

SeniorCard,,= G
,,,G H
discount,,I Q
),,Q R
;,,R S
break-- 
;-- 
default.. 
:.. 
throw// 
new// !
ArgumentException//" 3
(//3 4
$str//4 \
)//\ ]
;//] ^
}00 
}11 
}22 	
public44 
decimal44 &
calculatePriceCardDiscount44 1
(441 2
DiscountCards442 ?
discount_card44@ M
,44M N
int44O R

lowest_age44S ]
,44] ^
decimal44_ f

base_price44g q
)44q r
{55 	
if66 
(66 
discount_card66 
==66  
DiscountCards66! .
.66. /

FamilyCard66/ 9
&&66: <

lowest_age66= G
<66H I
$num66J L
)66L M
{77 
return88 

base_price88 !
*88" #
(88$ %
$num88% &
-88' (

_discounts88) 3
[883 4!
DiscountCardsInternal884 I
.88I J
FamilyCardChild88J Y
]88Y Z
)88Z [
;88[ \
}99 
else99 
if99 
(99 
discount_card99 $
==99% '
DiscountCards99( 5
.995 6

FamilyCard996 @
&&99A C

lowest_age99D N
>=99O Q
$num99R T
)99T U
{:: 
return;; 

base_price;; !
*;;" #
(;;$ %
$num;;% &
-;;' (

_discounts;;) 3
[;;3 4!
DiscountCardsInternal;;4 I
.;;I J
FamilyCardAdult;;J Y
];;Y Z
);;Z [
;;;[ \
}<< 
else== 
{>> 
return?? 

base_price?? !
*??" #
(??$ %
$num??% &
-??' (

_discounts??) 3
[??3 4!
DiscountCardsInternal??4 I
.??I J

SeniorCard??J T
]??T U
)??U V
;??V W
}@@ 
}AA 	
}BB 
}CC ∆
LC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\Model\TimeDiscount.cs
	namespace 	
VVPS_UPR
 
. 
Model 
{		 
public

 

class

 
TimeDiscount

 
{ 
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
DateTime 
From 
{ 
get "
;" #
set$ '
;' (
}) *
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
DateTime 
To 
{ 
get  
;  !
set" %
;% &
}' (
[ 	
JsonProperty	 
( 
$str  
)  !
]! "
public 
decimal 
Discount 
{  !
get" %
;% &
set' *
;* +
}, -
public 
TimeDiscount 
( 
DateTime $
from% )
,) *
DateTime+ 3
to4 6
,6 7
decimal8 ?
discount@ H
)H I
{ 	
From 
= 
from 
; 
To 
= 
to 
; 
Discount 
= 
discount 
;  
} 	
public 
bool 
isDiscounted  
(  !
DateTime! )
ticketStart* 5
)5 6
{ 	
TimeSpan 
	timeOfDay 
=  
ticketStart! ,
., -
	TimeOfDay- 6
;6 7
TimeSpan 
fromTime 
= 
From  $
.$ %
	TimeOfDay% .
;. /
TimeSpan 
toTime 
= 
To  
.  !
	TimeOfDay! *
;* +
return   
	timeOfDay   
>=   
fromTime    (
&&  ) +
	timeOfDay  , 5
<=  6 8
toTime  9 ?
;  ? @
}!! 	
}"" 
}## Ü
PC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\Model\TrainReservation.cs
	namespace 	
VVPS_UPR
 
. 
Model 
{		 
public

 

class

 
TrainReservation

 !
{ 
public 
TrainReservation 
(  

TrainRoute  *

trainRoute+ 5
,5 6
decimal7 >

finalPrice? I
,I J
stringK Q
passengerNameR _
)_ `
{ 	

TrainRoute 
= 

trainRoute #
;# $

FinalPrice 
= 

finalPrice #
;# $
PassengerName 
= 
passengerName )
;) *
IsActive 
= 
true 
; 
} 	
[ 	
JsonProperty	 
( 
$str #
)# $
]$ %
public 

TrainRoute 

TrainRoute $
{% &
get' *
;* +
set, /
;/ 0
}1 2
[ 	
JsonProperty	 
( 
$str #
)# $
]$ %
public 
decimal 

FinalPrice !
{" #
get$ '
;' (
set) ,
;, -
}. /
[ 	
JsonProperty	 
( 
$str &
)& '
]' (
public 
string 
PassengerName #
{$ %
get& )
;) *
set+ .
;. /
}0 1
[ 	
JsonProperty	 
( 
$str !
)! "
]" #
public 
bool 
IsActive 
{ 
get "
;" #
set$ '
;' (
}) *
} 
} ó
JC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\Model\TrainRoute.cs
	namespace 	
VVPS_UPR
 
. 
Model 
{		 
public

 

class

 

TrainRoute

 
{ 
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
string 
From 
{ 
get  
;  !
private" )
set* -
;- .
}/ 0
[ 	
JsonProperty	 
( 
$str 
) 
] 
public 
string 
To 
{ 
get 
; 
private  '
set( +
;+ ,
}- .
[ 	
JsonProperty	 
( 
$str  
)  !
]! "
public 
decimal 
Distance 
{  !
get" %
;% &
private' .
set/ 2
;2 3
}4 5
[ 	
JsonProperty	 
( 
$str &
)& '
]' (
public 
DateTime 
DepartureTime %
{& '
get( +
;+ ,
private- 4
set5 8
;8 9
}: ;
[ 	
JsonProperty	 
( 
$str $
)$ %
]% &
public 
DateTime 
ArrivalTime #
{$ %
get& )
;) *
private+ 2
set3 6
;6 7
}8 9
public 

TrainRoute 
( 
string  
from! %
,% &
string' -
to. 0
,0 1
decimal2 9
distance: B
,B C
DateTimeD L
departureTimeM Z
,Z [
DateTime\ d
arrivalTimee p
)p q
{ 	
From 
= 
from 
; 
To 
= 
to 
; 
Distance 
= 
distance 
;  
DepartureTime 
= 
departureTime )
;) *
ArrivalTime 
= 
arrivalTime %
;% &
} 	
public 
decimal 
CalculatePrice %
(% &
decimal& -
price_per_kilometer. A
)A B
{   	
return!! 
Distance!! 
*!! 
price_per_kilometer!! 1
;!!1 2
}"" 	
}## 
}$$ ≠)
AC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\Program.cs
	namespace 	
VVPS_UPR
 
{		 
internal

 
class

 
Program

 
{ 
static 
void 
Main 
( 
string 
[  
]  !
args" &
)& '
{ 	
try 
{ 
var 
json_config 
=  !
File" &
.& '
ReadAllText' 2
(2 3
$str3 @
)@ A
;A B
var 
config 
= 
JsonConvert (
.( )
DeserializeObject) :
<: ;

Dictionary; E
<E F
stringF L
,L M
ListN R
<R S

DictionaryS ]
<] ^
string^ d
,d e
objectf l
>l m
>m n
>n o
>o p
(p q
json_configq |
)| }
;} ~
var 
DISCOUNT_PERIODS $
=% &
config' -
[- .
$str. >
]> ?
;? @
Console 
. 
	WriteLine !
(! "
DISCOUNT_PERIODS" 2
)2 3
;3 4
var 
CARD_DISCOUNTS "
=# $
config% +
[+ ,
$str, <
]< =
;= >
Console 
. 
	WriteLine !
(! "
CARD_DISCOUNTS" 0
)0 1
;1 2
decimal 
PRICE_PER_KILOMETER +
=, -
$num. 4
;4 5
var 
json_train_routes %
=& '
File( ,
., -
ReadAllText- 8
(8 9
$str9 K
)K L
;L M
var %
deserialized_train_routes -
=. /
JsonConvert0 ;
.; <
DeserializeObject< M
<M N
ListN R
<R S

TrainRouteS ]
>] ^
>^ _
(_ `
json_train_routes` q
)q r
;r s
var 
trainRouteManager %
=& '
new( +
TrainRouteManager, =
(= >%
deserialized_train_routes> W
,W X
PRICE_PER_KILOMETERY l
)l m
;m n

TrainRoute!! 

trainRoute!! %
=!!& '
trainRouteManager!!( 9
.!!9 :
searchTrainRoutes!!: K
(!!K L
$str!!L S
,!!S T
$str!!U \
)!!\ ]
[!!] ^
$num!!^ _
]!!_ `
;!!` a
decimal"" 

base_price"" "
=""# $

trainRoute""% /
.""/ 0
CalculatePrice""0 >
(""> ?
PRICE_PER_KILOMETER""? R
)""R S
;""S T
int## 
age## 
=## 
$num## 
;## 
var$$ 
card$$ 
=$$ 
DiscountCards$$ (
.$$( )

FamilyCard$$) 3
;$$3 4
TimeDiscountManager'' #
timeDiscounts''$ 1
=''2 3
new''4 7
TimeDiscountManager''8 K
(''K L
DISCOUNT_PERIODS''L \
)''\ ]
;''] ^
CardDiscounts(( 
cardDiscounts(( +
=((, -
new((. 1
CardDiscounts((2 ?
(((? @
CARD_DISCOUNTS((@ N
)((N O
;((O P
var** 

finalPrice** 
=**  
timeDiscounts**! .
.**. /'
calculatePriceTimeDiscounts**/ J
(**J K

base_price**K U
,**U V

trainRoute**W a
.**a b
DepartureTime**b o
)**o p
;**p q

finalPrice++ 
=++ 
cardDiscounts++ *
.++* +&
calculatePriceCardDiscount+++ E
(++E F
card++F J
,++J K
age++L O
,++O P

finalPrice++Q [
)++[ \
;++\ ]
Console,, 
.,, 
	WriteLine,, !
(,,! "
$",," $
$str,,$ 1
{,,1 2

finalPrice,,2 <
},,< =
",,= >
),,> ?
;,,? @
var// 
ticket// 
=// 
new//  
TrainReservation//! 1
(//1 2

trainRoute//2 <
,//< =

finalPrice//> H
,//H I
$str//J P
)//P Q
;//Q R
ReservationManager22 "
reservationManager22# 5
=226 7
new228 ;
ReservationManager22< N
(22N O
$str22O g
)22g h
;22h i
reservationManager33 "
.33" #
AddReservation33# 1
(331 2
ticket332 8
)338 9
;339 :
Console55 
.55 
	WriteLine55 !
(55! "
$str55" P
)55P Q
;55Q R
}66 
catch77 
(77 !
FileNotFoundException77 (
ex77) +
)77+ ,
{88 
Console99 
.99 
	WriteLine99 !
(99! "
$str99" T
)99T U
;99U V
}:: 
};; 	
}>> 
}?? Ù#
LC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\ReservationManager.cs
	namespace		 	
VVPS_UPR		
 
{

 
class 	
ReservationManager
 
{ 
private 
readonly 
string 
	_filePath  )
;) *
public 
List 
< 
TrainReservation $
>$ %
reservations& 2
{3 4
get5 8
;8 9
private: A
setB E
;E F
}G H
public 
ReservationManager !
(! "
string" (
filePath) 1
)1 2
{ 	
	_filePath 
= 
filePath  
;  !
if 
( 
! 
File 
. 
Exists 
( 
	_filePath &
)& '
)' (
{ 
File 
. 
Create 
( 
	_filePath %
)% &
.& '
Close' ,
(, -
)- .
;. /
} 
string 
json 
= 
File 
. 
ReadAllText *
(* +
	_filePath+ 4
)4 5
;5 6
reservations 
= 
JsonConvert &
.& '
DeserializeObject' 8
<8 9
List9 =
<= >
TrainReservation> N
>N O
>O P
(P Q
jsonQ U
)U V
??W Y
newZ ]
List^ b
<b c
TrainReservationc s
>s t
(t u
)u v
;v w
} 	
public 
void 
AddReservation "
(" #
TrainReservation# 3
reservation4 ?
)? @
{ 	
reservations"" 
."" 
Add"" 
("" 
reservation"" (
)""( )
;"") *
string%% 
json%% 
=%% 
JsonConvert%% %
.%%% &
SerializeObject%%& 5
(%%5 6
reservations%%6 B
)%%B C
;%%C D
File&& 
.&& 
WriteAllText&& 
(&& 
	_filePath&& '
,&&' (
json&&) -
)&&- .
;&&. /
}'' 	
public)) 
void)) 
SaveReservations)) $
())$ %
)))% &
{** 	
string,, 
json,, 
=,, 
JsonConvert,, %
.,,% &
SerializeObject,,& 5
(,,5 6
reservations,,6 B
),,B C
;,,C D
File// 
.// 
WriteAllText// 
(// 
	_filePath// '
,//' (
json//) -
)//- .
;//. /
}00 	
public22 
List22 
<22 
TrainReservation22 $
>22$ %!
GetReservationsByUser22& ;
(22; <
string22< B
userName22C K
)22K L
{33 	
var44 
_searchResults44 
=44  
new44! $
List44% )
<44) *
TrainReservation44* :
>44: ;
(44; <
)44< =
;44= >
foreach66 
(66 
var66 
reservation66 $
in66% '
reservations66( 4
)664 5
{77 
if88 
(88 
reservation88 
.88  
PassengerName88  -
==88. 0
userName881 9
)889 :
{99 
_searchResults:: "
.::" #
Add::# &
(::& '
reservation::' 2
)::2 3
;::3 4
};; 
}<< 
return>> 
_searchResults>> !
;>>! "
}?? 	
publicAA 
voidAA 
CancelReservationAA %
(AA% &
TrainReservationAA& 6!
reservation_to_cancelAA7 L
)AAL M
{BB 	
foreachCC 
(CC 
varCC 
reservationCC #
inCC$ &
reservationsCC' 3
)CC3 4
{DD 
ifEE 
(EE 
reservationEE 
==EE  "!
reservation_to_cancelEE# 8
)EE8 9
{FF 
reservationGG 
.GG  
IsActiveGG  (
=GG) *
falseGG+ 0
;GG0 1
}HH 
}II 
SaveReservationsKK 
(KK 
)KK 
;KK 
}LL 	
}MM 
}NN ¿
MC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\TimeDiscountManager.cs
	namespace 	
VVPS_UPR
 
{		 
public

 

class

 
TimeDiscountManager

 $
{ 
public 
List 
< 
TimeDiscount  
>  !
_timeDiscounts" 0
{1 2
get3 6
;6 7
private8 ?
set@ C
;C D
}E F
public 
TimeDiscountManager "
(" #
List# '
<' (

Dictionary( 2
<2 3
string3 9
,9 :
object; A
>A B
>B C!
config_time_discountsD Y
)Y Z
{ 	
_timeDiscounts 
= 
new  
List! %
<% &
TimeDiscount& 2
>2 3
{4 5
}6 7
;7 8
foreach 
( 

Dictionary 
< 
string %
,% &
object' -
>- .
discount_period/ >
in? A!
config_time_discountsB W
)W X
{Y Z
var 
_from 
= 
DateTime $
.$ %
Parse% *
(* +
(+ ,
string, 2
)2 3
discount_period3 B
[B C
$strC I
]I J
)J K
;K L
var 
_to 
= 
DateTime "
." #
Parse# (
(( )
() *
string* 0
)0 1
discount_period1 @
[@ A
$strA E
]E F
)F G
;G H
var 
	_discount 
= 
decimal  '
.' (
Parse( -
(- .
discount_period. =
[= >
$str> H
]H I
.I J
ToStringJ R
(R S
)S T
)T U
;U V
_timeDiscounts 
. 
Add "
(" #
new# &
TimeDiscount' 3
(3 4
_from4 9
,9 :
_to; >
,> ?
	_discount@ I
)I J
)J K
;K L
} 
} 	
public 
decimal '
calculatePriceTimeDiscounts 2
(2 3
decimal3 :

base_price; E
,E F
DateTimeG O
ticket_start_timeP a
)a b
{ 	
decimal 
discount_rate !
=" #
$num$ %
;% &
foreach!! 
(!! 
var!! 
discount_period!! (
in!!) +
_timeDiscounts!!, :
)!!: ;
{"" 
if$$ 
($$ 
discount_period$$ #
.$$# $
isDiscounted$$$ 0
($$0 1
ticket_start_time$$1 B
)$$B C
)$$C D
{%% 
discount_rate&& !
=&&" #
discount_period&&$ 3
.&&3 4
Discount&&4 <
;&&< =
break'' 
;'' 
}(( 
})) 
var,, 
discounted_price,,  
=,,! "

base_price,,# -
*,,. /
(,,0 1
$num,,1 2
-,,3 4
discount_rate,,5 B
),,B C
;,,C D
return.. 
discounted_price.. #
;..# $
}// 	
}00 
}11 Æ
KC:\Users\danim\Documents\ProgCSharp8\VVPS_UPR\VVPS_UPR\TrainRouteManager.cs
	namespace 	
VVPS_UPR
 
{		 
public

 

class

 
TrainRouteManager

 "
{ 
public 
List 
< 

TrainRoute 
> 
TrainRoutes  +
;+ ,
public 
decimal 
PricePerKilometer (
{) *
get+ .
;. /
private0 7
set8 ;
;; <
}= >
public 
TrainRouteManager  
(  !
List! %
<% &

TrainRoute& 0
>0 1
trainRoutes2 =
,= >
decimal? F
pricePerKilometerG X
)X Y
{ 	
TrainRoutes 
= 
trainRoutes %
;% &
PricePerKilometer 
= 
pricePerKilometer  1
;1 2
} 	
public 
List 
< 

TrainRoute 
> 
searchTrainRoutes  1
(1 2
string2 8
from_destination9 I
,I J
stringL R
to_destinationS a
,a b
TimeSpanc k
?k l
	from_timem v
=w x
nully }
,} ~
TimeSpan	 á
?
á à
to_time
â ê
=
ë í
null
ì ó
)
ó ò
{ 	
var 
searchResults 
= 
new  #
List$ (
<( )

TrainRoute) 3
>3 4
(4 5
)5 6
;6 7
foreach 
( 
var 
route 
in !
TrainRoutes" -
)- .
{ 
if 
( 
from_destination $
.$ %
Equals% +
(+ ,
route, 1
.1 2
From2 6
)6 7
&&8 :
to_destination; I
.I J
EqualsJ P
(P Q
routeQ V
.V W
ToW Y
)Y Z
)Z [
{ 
if 
( 
	from_time !
.! "
HasValue" *
&&+ -
to_time. 5
.5 6
HasValue6 >
)> ?
{ 
var  
departure_time_route 0
=1 2
route3 8
.8 9
DepartureTime9 F
.F G
	TimeOfDayG P
;P Q
if 
(  
departure_time_route 0
<1 2
	from_time3 <
&&= ? 
departure_time_route@ T
<U V
to_timeW ^
)^ _
{   
searchResults!! )
.!!) *
Add!!* -
(!!- .
route!!. 3
)!!3 4
;!!4 5
}"" 
}## 
else$$ 
{%% 
searchResults&& %
.&&% &
Add&&& )
(&&) *
route&&* /
)&&/ 0
;&&0 1
}'' 
}(( 
})) 
return** 
searchResults**  
;**  !
}++ 	
},, 
}-- 